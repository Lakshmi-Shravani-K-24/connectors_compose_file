const fs = require('fs');

fs.readFile('./trivy_output.json', 'utf8', (err, data) => {
    if (err) {
        console.error('Error reading JSON file:', err);
        return;
    }

    try {
        const trivyOutput = JSON.parse(data);
        const severityCounts = {
            UNKNOWN: 0,
            LOW: 0,
            MEDIUM: 0,
            HIGH: 0,
            CRITICAL: 0
        };

        trivyOutput.Results.forEach(result => {
            if (result.Vulnerabilities) {
                result.Vulnerabilities.forEach(vulnerability => {
                    const severity = vulnerability.Severity.toUpperCase();
                    severityCounts[severity] = (severityCounts[severity] || 0) + 1;
                });
            }
        });

        for (const [severity, count] of Object.entries(severityCounts)) {
            console.log(`${severity}:`, count);
        }
    } catch (error) {
        console.error('Error parsing JSON:', error);
    }
});
