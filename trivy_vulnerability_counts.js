const fs = require('fs');

fs.readFile('./trivy_output.json', 'utf8', (err, data) => {
    if (err) {
        console.error('Error reading JSON file:', err);
        return;
    }

    try {
        const trivyOutput = JSON.parse(data);
        let unknownCount = 0;
        let lowCount = 0;
        let mediumCount = 0;
        let highCount = 0;
        let criticalCount = 0;

        trivyOutput.Results[1].Vulnerabilities.forEach(vulnerability => {
            switch (vulnerability.Severity.toUpperCase()) {
                case 'UNKNOWN':
                    unknownCount++;
                    break;
                case 'LOW':
                    lowCount++;
                    break;
                case 'MEDIUM':
                    mediumCount++;
                    break;
                case 'HIGH':
                    highCount++;
                    break;
                case 'CRITICAL':
                    criticalCount++;
                    break;
                default:
                    break;
            }
        });

        console.log('UNKNOWN:', unknownCount);
        console.log('LOW:', lowCount);
        console.log('MEDIUM:', mediumCount);
        console.log('HIGH:', highCount);
        console.log('CRITICAL:', criticalCount);
    } catch (error) {
        console.error('Error parsing JSON:', error);
    }
});
